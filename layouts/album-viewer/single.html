{{ define "main" }}

<main class="album-wrap">

    <header class="album-header">
        <p class="album-meta">Album</p>
        <h1>{{ .Title }}</h1>
        {{ with .Params.description }}
        <p class="album-meta">{{ . }}</p>
        {{ end }}
    </header>

    {{ $album := .Params.album }}

    {{ if not $album }}
    <div class="av-note">
        <strong>Error:</strong> no <code>album</code> param found.
    </div>
    {{ else }}

    {{ $pattern := printf "images/gallery/%s/*" $album }}
    {{ $resources := resources.Match $pattern | sort }}

    {{ if gt (len $resources) 0 }}
    <section class="album-grid" aria-live="polite">
        {{ range $resources }}

        {{ $ext := lower (replaceRE "^.*\\.([^.]+)$" "$1" .Name) }}
        {{ if in (slice "jpg" "jpeg" "png" "webp" "gif") $ext }}

        {{ $small := .Resize "600x" }}
        {{ $med := .Resize "1200x" }}

        <figure class="album-tile">
            <a class="album-link"
               href="{{ .RelPermalink }}"
               data-pswp-width="{{ .Width }}"
               data-pswp-height="{{ .Height }}"
               data-pswp-caption="{{ .Name }}">

                <img
                        class="grid-img"
                        src="{{ $small.RelPermalink }}"
                        srcset="{{ $small.RelPermalink }} 600w, {{ $med.RelPermalink }} 1200w"
                        sizes="(max-width:640px) 100vw, (max-width:1200px) 50vw, 33vw"
                        alt="{{ .Name }}"
                        loading="lazy"
                        decoding="async">
            </a>
        </figure>

        {{ end }}
        {{ end }}
    </section>
    {{ else }}
    <div class="av-note">No images found in album.</div>
    {{ end }}

    {{ end }}

</main>

{{ end }}
