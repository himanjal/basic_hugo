{{ define "main" }}

<main class="album-wrap">

    <header class="album-header">
<!--        <p class="album-meta">Album</p>-->
        <h1>{{ .Title }}</h1>
        {{ with .Params.description }}
        <p class="album-meta">{{ . }}</p>
        {{ end }}
    </header>

    {{ $album := .Params.album }}

    {{ if not $album }}
    <div class="av-note">
        <strong>Error:</strong> no <code>album</code> param found.
    </div>
    {{ else }}

    {{ $pattern := printf "images/gallery/%s/*" $album }}
    {{ $resources := resources.Match $pattern | sort }}

    {{ if gt (len $resources) 0 }}
    <section class="album-grid" aria-live="polite">
        {{ range $resources }}

        {{ $ext := lower (replaceRE "^.*\\.([^.]+)$" "$1" .Name) }}
        {{ if in (slice "jpg" "jpeg" "png" "webp" "gif") $ext }}

        {{/* Calculate Aspect Ratio for Flexbox logic */}}
        {{ $aspectRatio := div (float .Width) (float .Height) }}

        {{ $small := .Resize "600x webp q50" }}
        {{ $med := .Resize "1200x webp q60" }}

        <figure class="album-tile" style="flex-grow: {{ $aspectRatio }}; flex-basis: {{ mul $aspectRatio 200 }}px;">
            <a class="album-link"
               href="{{ .RelPermalink }}"
               data-pswp-width="{{ .Width }}"
               data-pswp-height="{{ .Height }}"
               data-pswp-caption="{{ .Name }}"
               data-pswp-msrc="{{ $small.RelPermalink }}">

                <img class="grid-img"
                     src="{{ $small.RelPermalink }}"
                     srcset="{{ $small.RelPermalink }} 600w, {{ $med.RelPermalink }} 1200w"
                     sizes="(max-width:640px) 100vw, (max-width:1200px) 50vw, 33vw"
                     width="{{ $small.Width }}"
                     height="{{ $small.Height }}"
                     style="aspect-ratio: {{ $aspectRatio }};"
                     alt="{{ .Name }}"
                     loading="lazy"
                     decoding="async">
            </a>
        </figure>

        {{ end }}
        {{ end }}
    </section>
    {{ else }}
    <div class="av-note">No images found in album.</div>
    {{ end }}

    {{ end }}

</main>

{{ end }}